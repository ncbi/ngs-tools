if (CMAKE_VERSION VERSION_LESS "3.1")
   if (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
      set (CMAKE_CXX_FLAGS "-std=gnu++11 ${CMAKE_CXX_FLAGS}")
   endif ()
else ()
   set (CMAKE_CXX_STANDARD 11)
endif ()

FIND_PACKAGE ( OpenMP REQUIRED )
set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}" )
set ( CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}" )

set ( SHARED_OBJECTS src/reader.cpp )

add_executable ( aligns_to                      src/aligns_to.cpp ${SHARED_OBJECTS})
add_executable ( dump_kmers                     src/dump_kmers.cpp ${SHARED_OBJECTS})
add_executable ( build_index                    src/build_index.cpp ${SHARED_OBJECTS})
add_executable ( build_index_of_each_file       src/build_index_of_each_file.cpp ${SHARED_OBJECTS})
add_executable ( merge_db                       src/merge_db.cpp ${SHARED_OBJECTS})
add_executable ( merge_tax_ids                  src/merge_tax_ids.cpp ${SHARED_OBJECTS})
add_executable ( merge_kingdoms                 src/merge_kingdoms.cpp ${SHARED_OBJECTS})
add_executable ( build_index_multi              src/build_index_multi.cpp ${SHARED_OBJECTS})
add_executable ( check_index                    src/check_index.cpp ${SHARED_OBJECTS})
add_executable ( check_index_multi              src/check_index_multi.cpp ${SHARED_OBJECTS})
add_executable ( db_fasta_to_bin                src/db_fasta_to_bin.cpp ${SHARED_OBJECTS})
add_executable ( db_tax_id_to_dbs               src/db_tax_id_to_dbs.cpp ${SHARED_OBJECTS})
add_executable ( db_to_dbs                      src/db_to_dbs.cpp ${SHARED_OBJECTS})
add_executable ( identify_tax_ids               src/identify_tax_ids.cpp ${SHARED_OBJECTS})
add_executable ( db_fasta_to_bin_multi          src/db_fasta_to_bin_multi.cpp ${SHARED_OBJECTS})
add_executable ( filter_db                      src/filter_db.cpp ${SHARED_OBJECTS})
add_executable ( filter_dbs                     src/filter_dbs.cpp ${SHARED_OBJECTS})
add_executable ( filter_db_multi                src/filter_db_multi.cpp ${SHARED_OBJECTS})
add_executable ( contig_builder                 src/contig_builder.cpp ${SHARED_OBJECTS})
links_and_install_subdir (contig_builder tax)
add_executable ( fasta_contamination            src/fasta_contamination.cpp ${SHARED_OBJECTS})
add_executable ( fasta_contamination_multi      src/fasta_contamination_multi.cpp ${SHARED_OBJECTS})
add_executable ( find_closest_profile_linear    src/find_closest_profile_linear.cpp ${SHARED_OBJECTS})
links_and_install_subdir (find_closest_profile_linear tax)
add_executable ( contig_connectivity            src/contig_connectivity.cpp ${SHARED_OBJECTS})
links_and_install_subdir (contig_connectivity tax)
add_executable ( sort_dbs                       src/sort_dbs.cpp ${SHARED_OBJECTS})
add_executable ( print_dbs                      src/print_dbs.cpp ${SHARED_OBJECTS})

include_directories ( ${CMAKE_SOURCE_DIR} )

target_link_libraries ( aligns_to ${SYS_LIBRARIES} )
target_link_libraries ( dump_kmers ${SYS_LIBRARIES} )
target_link_libraries ( build_index ${SYS_LIBRARIES} )
target_link_libraries ( build_index_of_each_file ${SYS_LIBRARIES} )
target_link_libraries ( merge_db ${SYS_LIBRARIES} )
target_link_libraries ( merge_tax_ids ${SYS_LIBRARIES} )
target_link_libraries ( merge_kingdoms ${SYS_LIBRARIES} )
target_link_libraries ( build_index_multi ${SYS_LIBRARIES} )
target_link_libraries ( check_index ${SYS_LIBRARIES} )
target_link_libraries ( check_index_multi ${SYS_LIBRARIES} )
target_link_libraries ( db_fasta_to_bin ${SYS_LIBRARIES} )
target_link_libraries ( db_tax_id_to_dbs ${SYS_LIBRARIES} )
target_link_libraries ( db_to_dbs ${SYS_LIBRARIES} )
target_link_libraries ( identify_tax_ids ${SYS_LIBRARIES} )
target_link_libraries ( db_fasta_to_bin_multi ${SYS_LIBRARIES} )
target_link_libraries ( filter_db ${SYS_LIBRARIES} )
target_link_libraries ( filter_dbs ${SYS_LIBRARIES} )
target_link_libraries ( filter_db_multi ${SYS_LIBRARIES} )
target_link_libraries ( contig_builder ${SYS_LIBRARIES} )
target_link_libraries ( fasta_contamination ${SYS_LIBRARIES} )
target_link_libraries ( fasta_contamination_multi ${SYS_LIBRARIES} )
target_link_libraries ( find_closest_profile_linear ${SYS_LIBRARIES} )
target_link_libraries ( contig_connectivity ${SYS_LIBRARIES} )
target_link_libraries ( sort_dbs ${SYS_LIBRARIES} )
target_link_libraries ( print_dbs ${SYS_LIBRARIES} )

install ( TARGETS aligns_to dump_kmers build_index build_index_of_each_file merge_db merge_tax_ids merge_kingdoms build_index_multi check_index check_index_multi db_to_dbs db_tax_id_to_dbs identify_tax_ids db_fasta_to_bin db_fasta_to_bin_multi filter_db filter_dbs filter_db_multi
                  contig_builder fasta_contamination fasta_contamination_multi find_closest_profile_linear
                  contig_connectivity print_dbs sort_dbs
          RUNTIME DESTINATION bin/tax )

if (NOT ${CMAKE_SYSTEM_NAME} MATCHES "Windows")
    add_executable ( get_profile src/get_profile ${SHARED_OBJECTS})
    target_link_libraries ( get_profile ${SYS_LIBRARIES} )
    install ( TARGETS get_profile RUNTIME DESTINATION bin/tax )
endif()

add_subdirectory ( src/tests )
